"use strict";var app=angular.module("geckoboardGithubApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).constant("GITHUB_API_URL","https://api.github.com").constant("GITHUB_USER","mikermcneil").config(["$routeProvider","GITHUB_USER",function(a,b){a.when("/",{redirectTo:"/users/"+b}).when("/users/:user",{templateUrl:"views/main.html",controller:"MainController",resolve:{user:["$route","$q","UserService",function(a,b,c){var d=b.defer(),e=c.data();return $.isEmptyObject(e)||e.login!==a.current.params.user?c.populate(a.current.params.user).then(function(a){d.resolve(a)},function(a){d.reject(a)}):d.resolve(e),d.promise}],repos:["$route","$q","ReposService",function(a,b,c){var d=b.defer(),e=c.data();return $.isEmptyObject(e)?c.populate(a.current.params.user).then(function(a){d.resolve(a)},function(a){d.reject(a)}):d.resolve(e),d.promise}]}}).when("/repos/:user/:repo",{templateUrl:"views/main.html",controller:"RepoController",resolve:{repo:["$route","$q","RepoService",function(a,b,c){return c.populate(a.current.params.user,a.current.params.repo)}],user:["$route","$q","UserService",function(a,b,c){var d=b.defer(),e=c.data();return $.isEmptyObject(e)||e.login!==a.current.params.user?c.populate(a.current.params.user).then(function(a){d.resolve(a)},function(a){d.reject(a)}):d.resolve(e),d.promise}]}}).otherwise({redirectTo:"/"})}]);app.controller("MainController",["$scope","user","repos",function(a,b,c){angular.forEach(c,function(a,b){c[b].iconCls=a.fork?"octicon-repo-forked":"octicon-repo"}),b.hasData=angular.isUndefined(b.id)?!1:!0,a.user=b,a.repos=c}]),app.controller("RepoController",["$scope","repo","user",function(a,b,c){c.hasData=angular.isUndefined(c.id)?!1:!0,b.hasData=angular.isUndefined(b.id)?!1:!0,a.repo=b,a.user=c}]),app.service("UserService",["$resource","$q","GITHUB_API_URL",function(a,b,c){var d=a(c+"/users/:user",{user:"@user"},{starred:{method:"GET",url:c+"/users/:user/starred?page=0&per_page=100",isArray:!0}}),e={};return{data:function(){return e},populate:function(a){var c=b.defer(),f=d.get({user:a}),g=d.starred({user:a});return b.when(f.$promise).then(function(a){return e=a,e.avatar_url+="&s=440",g.$promise},function(){return e={},g.$promise}).then(function(a){e.starred=a.length,c.resolve(e)},function(){e.starred=0,c.resolve(e)}),c.promise}}}]),app.service("ReposService",["$resource","$q","GITHUB_API_URL",function(a,b,c){var d=a(c+"/users/:user/repos?page=0&per_page=100",{user:"@user"}),e={};return{data:function(){return e},populate:function(a){var c=b.defer();return b.when(d.query({user:a}).$promise).then(function(a){angular.forEach(a,function(b,c){a[c].iconCls=b.fork?"octicon-repo-forked":"octicon-repo"}),e=a,c.resolve(e)},function(){e={},c.resolve(e)}),c.promise}}}]),app.service("RepoService",["$resource","$q","$filter","GITHUB_API_URL",function(a,b,c,d){var e=a(d+"/repos/:user/:repo",{user:"@user",repo:"@repo"},{branches:{method:"GET",url:d+"/repos/:user/:repo/branches?page=0&per_page=100",isArray:!0},releases:{method:"GET",url:d+"/repos/:user/:repo/releases?page=0&per_page=100",isArray:!0},contributors:{method:"GET",url:d+"/repos/:user/:repo/contributors?page=0&per_page=100",isArray:!0},tags:{method:"GET",url:d+"/repos/:user/:repo/tags?page=0&per_page=100",isArray:!0},languages:{method:"GET",url:d+"/repos/:user/:repo/languages?page=0&per_page=100"}});return{populate:function(a,d){var f=b.defer(),g=e.get({user:a,repo:d}),h=e.branches({user:a,repo:d}),i=e.releases({user:a,repo:d}),j=e.contributors({user:a,repo:d}),k=e.tags({user:a,repo:d}),l=e.languages({user:a,repo:d}),m={};return b.when(g.$promise).then(function(a){return m=a,h.$promise},function(){return m={},h.$promise}).then(function(a){return m.branches=a.length,i.$promise},function(){return m.branches=0,i.$promise}).then(function(a){return m.releases=a.length,j.$promise},function(){return m.releases=0,j.$promise}).then(function(a){return m.contributors=a.length,k.$promise},function(){return m.contributors=0,k.$promise}).then(function(a){return m.tags=a.length,l.$promise},function(){return m.tags=0,l.$promise}).then(function(a){var b=c("orderBy"),d=[],e=[],g=4,h=0;angular.forEach(a,function(b,c){"$promise"!==c&&"$resolved"!==c&&a.hasOwnProperty(c)&&d.push({name:c,percentage:b})}),d.length>0?(d=b(d,"perc",!0),d.length<g&&(g=d.length),angular.forEach(d,function(a){return e.push(a),h+=a.percentage,g--,0===g?!1:void 0}),angular.forEach(e,function(a){a.percentage=Math.round(100*a.percentage/h)}),m.languages=e):m.languages=[],f.resolve(m)},function(){m.languages=[],f.resolve(m)}),f.promise}}}]),app.directive("ghUser",function(){return{restrict:"E",templateUrl:"views/partials/User.html"}}),app.directive("ghRepos",function(){return{restrict:"E",templateUrl:"views/partials/Repos.html",link:function(a,b){a.$on("repos",function(c){c.currentScope.repos?(a.repos=c.currentScope.repos,$("gh-repo").fadeOut(500,function(){b.fadeIn()})):b.fadeOut(500,function(){$(".gh-repo").fadeIn()})})}}}),app.directive("ghRepo",function(){return{restrict:"E",templateUrl:"views/partials/Repo.html",link:function(a,b){angular.isUndefined(a.repo)?b.hide():b.show()}}}),app.directive("ghRepoLink",function(){return{restrict:"A",link:function(a,b){b.bind("click",$.proxy(function(){this.repository.iconCls="spinner"},a))}}});